{% extends 'base.html' %}
{% load static %}

{% block title %}Feed - LITRevu{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'reviews/css/feed.css' %}">
{% endblock %}

{% block content %}
<div class="button-head">
    <a href="{% url 'reviews:ticket_create' %}">Demandez un ticket</a>
    <a href="{% url 'reviews:review_create' %}">Créez une critique</a>
</div>


<div class="posts">    

    {% for post in list_posts %}
        <div class="post-container">

            {% if post.content_type == 'ticket' %}
                    <div class="post-header">
                        {% if post.user.profile_picture %}
                            <img src="{{ post.user.profile_picture }}" alt="photo {{ post.user.username}}">
                        {% else %}
                            <img src="{% static 'pictures/default_pictures/default.png' %}" alt="photo {{ followed_user.username }}">
                        {% endif %}
                        <h2>
                            {% if post.user == request.user %}
                                Vous avez demandé une critique
                            {% else %}
                                {{ post.user.username }} a demandé une critique
                            {% endif %}
                        </h2>
                        <small> {{ post.time_created|date:"d/m/Y à H:i" }}</small>
                    </div>

                    <div class="post-content ticket">
                        {% if post.image %}
                            <img src="{{ post.image.url }}" alt="Couverture {{ post.title }}">
                        {% else %}
                            <img src="https://picsum.photos/seed/{{ post.id }}/600/400" alt="Couverture {{ post.title }}">
                        {% endif %}
                        <div>
                            <h3>{{ post.title}}</h3>
                            <p>{{ post.description }}</p>
                            {% if  post.id not in reviewed_ticket_ids %}
                                <a href="{% url 'reviews:review_create_for_ticket' post.id %}">Créer une critique</a>
                            {% elif  post.user in blocked_me%}
                                <a>bloqué</a>
                            {% endif %}
                        </div>

                    </div>
            {% endif %}

            {% if post.content_type == 'review' %}
                <div class="post-header">
                        {% if post.user.profile_picture %}
                            <img src="{{ post.user.profile_picture }}" alt="photo {{ post.user.username}}">
                        {% else %}
                            <img src="{% static 'pictures/default_pictures/default.png' %}" alt="photo {{ followed_user.username }}">
                        {% endif %}
                        <h2>
                            {% if post.user == request.user %}
                                Vous avez publié une critique
                            {% else %}
                                {{ post.user.username }} a publié une critique
                            {% endif %}
                        </h2>
                        <small> {{ post.time_created|date:"d/m/Y à H:i" }}</small>
                    </div>
                    <div class="post-content">
                        <h3>{{ post.headline }}
                            <span>
                                {% for i in "12345" %}
                                    {% if forloop.counter <= post.rating %}★{% else %}☆{% endif %}
                                {% endfor %}
                            </span>
                        </h3>
                        {% if post.body %}
                            <p>{{ post.body }}</p>
                        {% endif %}
                    </div>
                    <div class="content-related ticket">
                        {% if post.ticket.image %}
                            <img src="{{ post.ticket.image.url }}" alt="Couverture {{ post.ticket.title }}">
                        {% else %}
                            <img src="https://picsum.photos/seed/{{ post.ticket.id }}/600/400" alt="Couverture {{ post.title }}">
                        {% endif %}
                        <div>
                            <p>Ticket - {{ post.ticket.user }}</p>
                            <p>{{ post.ticket.title }}</p>
                            {% if  post.ticket.id not in reviewed_ticket_ids%}
                                <a href="{% url 'reviews:review_create_for_ticket' post.ticket.id %}">Créer une critique</a>
                            {% elif post.ticket.user == post.user%}
                                <a href="{% url 'reviews:review_create_for_ticket' post.ticket.id %}">Créer une critique</a>
                            {% elif  post.user in blocked_me%}
                                <a>bloqué</a>
                            {% endif %}
                        </div>
                    </div>

            {% endif %}
        </div>
    {% empty %}
        <div class="no-posts">
            <p>Aucun post dans votre flux.</p>
            <p>Commencez par <a href="{% url 'reviews:follow' %}">suivre des utilisateurs</a> !</p>
        </div>
    {% endfor %}

</div>
{% endblock %}